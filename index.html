<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 æ±äº¬è¡Œå‹•åš®å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --jp-white: #FCFBF9;
            --jp-black: #2C2C2C;
            --sakura: #F3D2D9;
            --fuji-blue: #A5BFD2;
        }
        body {
            font-family: 'Noto Sans JP', 'Noto Sans TC', sans-serif;
            background-color: var(--jp-white);
            color: var(--jp-black);
            padding-bottom: 120px;
        }
        .app-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .nav-active { color: var(--jp-black); font-weight: 700; }
        .nav-inactive { color: #A1A1AA; }
        
        .tag-eat { background-color: #FEE2E2; color: #B91C1C; } 
        .tag-spot { background-color: #DBEAFE; color: #1E40AF; } 
        .tag-trans { background-color: #F3F4F6; color: #374151; } 
        .tag-buy { background-color: #FEF3C7; color: #92400E; } 

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .click-effect:active { transform: scale(0.97); }
        
        .input-field { background: #F9FAFB; border: 1px solid #F3F4F6; border-radius: 12px; padding: 10px 14px; font-size: 14px; width: 100%; }
        .payer-btn, .currency-btn { border: 2px solid transparent; transition: all 0.2s; background-color: #f3f4f6; color: #9CA3AF; }
        .payer-btn.active, .currency-btn.active { border-color: var(--jp-black); background-color: white; color: var(--jp-black); font-weight: bold; }
        .member-checkbox:checked + label { background-color: var(--fuji-blue); color: white; border-color: var(--fuji-blue); }
        
        /* å…¨å±€ç§»é™¤æ–œé«” */
        * { font-style: normal !important; }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-md px-6 py-4 flex justify-between items-end border-b border-gray-100">
        <div>
            <p class="text-[10px] tracking-widest text-gray-400 font-bold uppercase">2026 æ±äº¬ä¹‹æ—… 03.25 - 03.31</p>
            <h1 id="current-page-title" class="text-xl font-bold">æ¯æ—¥è¡Œç¨‹</h1>
        </div>
        <div class="text-right">
            <span id="header-date" class="text-xs font-medium text-gray-500 underline decoration-sakura underline-offset-4">03/25 WED</span>
        </div>
    </header>

    <main class="px-4 py-4 max-w-md mx-auto">
        
        <!-- PAGE 1: è¡Œç¨‹ -->
        <section id="page-schedule" class="page active">
            <div class="flex gap-3 overflow-x-auto no-scrollbar mb-6 pb-2" id="day-scroller" style="scrollbar-width: none;"></div>
            <div id="timeline" class="space-y-6"></div>
        </section>

        <!-- PAGE 2: é ç´„ä¸­å¿ƒ -->
        <section id="page-tools" class="page">
            <div class="space-y-6">
                <div class="app-card p-5 border-t-4 border-red-500">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2 text-gray-800">â° æ¶ç¥¨é ç´„æ—¥ (ä¾æ—¥æœŸæ’åº)</h3>
                    <div class="space-y-4">
                        <div class="p-3 bg-gray-50 rounded-xl">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-bold text-gray-700">Peter Luger ç‰›æ’ (3/27å¸­)</span>
                                <span class="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded">60å¤©å‰</span>
                            </div>
                            <div class="flex justify-between items-end">
                                <span class="text-sm font-bold text-red-500">ç´„ 01/26 é–‹è³£</span>
                                <a href="https://www.tablecheck.com/shops/peterluger-tokyo/reserve" target="_blank" class="text-[10px] bg-gray-800 text-white px-3 py-1.5 rounded-lg font-bold">å‰å¾€é ç´„</a>
                            </div>
                        </div>

                        <div class="p-3 bg-gray-50 rounded-xl">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-bold text-gray-700">å‰åœåŠ›ç¾è¡“é¤¨ (3/27ç¥¨)</span>
                                <span class="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded">æ¯æœˆ10æ—¥</span>
                            </div>
                            <div class="flex justify-between items-end">
                                <span class="text-sm font-bold text-red-500">02/10 10:00 é–‹è³£</span>
                                <a href="https://www.ghibli-museum.jp/en/tickets/" target="_blank" class="text-[10px] bg-gray-800 text-white px-3 py-1.5 rounded-lg font-bold">å‰å¾€æ¶ç¥¨</a>
                            </div>
                        </div>

                        <div class="p-3 bg-gray-50 rounded-xl">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-bold text-gray-700">ç‰›èˆŒçš„æª¸æª¬ (3/25å¸­)</span>
                                <span class="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded">30å¤©å‰</span>
                            </div>
                            <div class="flex justify-between items-end">
                                <span class="text-sm font-bold text-red-500">02/23 é–‹è³£</span>
                                <a href="https://www.tablecheck.com/shops/gyutan-lemon/reserve" target="_blank" class="text-[10px] bg-gray-800 text-white px-3 py-1.5 rounded-lg font-bold">å‰å¾€é ç´„</a>
                            </div>
                        </div>

                        <div class="p-3 bg-gray-50 rounded-xl">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-bold text-gray-700">Pokemon Cafe (3/30å¸­)</span>
                                <span class="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded">31å¤©å‰</span>
                            </div>
                            <div class="flex justify-between items-end">
                                <span class="text-sm font-bold text-red-500">02/27 18:00 é–‹è³£</span>
                                <a href="https://www.pokemoncenter-online.com/cafe/reservation/" target="_blank" class="text-[10px] bg-gray-800 text-white px-3 py-1.5 rounded-lg font-bold">å‰å¾€æ¶ä½</a>
                            </div>
                        </div>

                        <div class="p-3 bg-gray-50 rounded-xl">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-bold text-gray-700">å¯Œå£«å›éŠè™Ÿ (3/29ç¥¨)</span>
                                <span class="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded">1å€‹æœˆå‰</span>
                            </div>
                            <div class="flex justify-between items-end">
                                <span class="text-sm font-bold text-red-500">02/28 10:00 é–‹è³£</span>
                                <a href="https://www.eki-net.com/zh-CHT/jreast-train-reservation/Top/Index" target="_blank" class="text-[10px] bg-gray-800 text-white px-3 py-1.5 rounded-lg font-bold">å‰å¾€è¨‚ç¥¨</a>
                            </div>
                        </div>

                         <div class="p-3 bg-gray-50 rounded-xl">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-xs font-bold text-gray-700">è‚‰ç‡’å±‹ D-29 (3/28å¸­)</span>
                                <span class="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded">ç´„1å€‹æœˆå‰</span>
                            </div>
                            <div class="flex justify-between items-end">
                                <span class="text-sm font-bold text-red-500">ç´„ 02/28 é–‹è³£</span>
                                <a href="https://www.tablecheck.com/shops/yakiniku-d29-ebisu/reserve" target="_blank" class="text-[10px] bg-gray-800 text-white px-3 py-1.5 rounded-lg font-bold">å‰å¾€é ç´„</a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="app-card p-5">
                    <h3 class="font-bold text-lg border-l-4 border-blue-500 pl-2 mb-4 uppercase tracking-tighter">èˆªç­èˆ‡ä½å®¿</h3>
                    <div class="space-y-3 text-xs text-gray-600 leading-relaxed font-sans">
                        <p class="font-bold text-blue-600 uppercase">Scoot TR898 | 03/25 06:40 TPE</p>
                        <p class="font-bold text-red-600 uppercase">Peach MM625 | 03/31 16:50 NRT</p>
                        <p class="pt-2 border-t border-gray-100 font-medium text-gray-800">ä½å®¿ï¼šVIA INN ç§‹è‘‰åŸ</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=VIA+INN+Akihabara" target="_blank" class="block text-center mt-2 py-2 bg-gray-100 rounded-xl font-bold">ğŸ“ å°èˆªè‡³é£¯åº—</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- PAGE 3: å¸³æœ¬ -->
        <section id="page-ledger" class="page">
            <div class="app-card p-5 mb-6 bg-slate-900 text-white shadow-xl">
                <h3 class="font-bold opacity-80 mb-4 text-center text-xs tracking-widest uppercase">çµç®—ç¸½è¦½ (å¹£åˆ¥ç¨ç«‹)</h3>
                <div class="grid grid-cols-3 gap-2">
                    <div class="text-center">
                        <p class="text-[10px] font-bold opacity-50 mb-2 border-b border-white/10 pb-1 uppercase">ç¾Š</p>
                        <p id="sum-jpy-ç¾Š" class="font-mono text-[11px] text-fuji-blue font-bold">Â¥ 0</p>
                        <p id="sum-twd-ç¾Š" class="font-mono text-[11px] text-sakura font-bold">$ 0</p>
                    </div>
                    <div class="text-center border-x border-white/5">
                        <p class="text-[10px] font-bold opacity-50 mb-2 border-b border-white/10 pb-1 uppercase">P</p>
                        <p id="sum-jpy-P" class="font-mono text-[11px] text-fuji-blue font-bold">Â¥ 0</p>
                        <p id="sum-twd-P" class="font-mono text-[11px] text-sakura font-bold">$ 0</p>
                    </div>
                    <div class="text-center">
                        <p class="text-[10px] font-bold opacity-50 mb-2 border-b border-white/10 pb-1 uppercase">é¦®</p>
                        <p id="sum-jpy-é¦®" class="font-mono text-[11px] text-fuji-blue font-bold">Â¥ 0</p>
                        <p id="sum-twd-é¦®" class="font-mono text-[11px] text-sakura font-bold">$ 0</p>
                    </div>
                </div>
            </div>

            <div class="app-card p-5 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-sm">è¨˜ä¸€ç­†æ”¯å‡º</h3>
                    <div class="flex bg-gray-100 rounded-lg p-1 gap-1">
                        <button onclick="setCurrency('JPY')" id="cur-JPY" class="currency-btn px-4 py-1 rounded-md text-[10px]">JPY</button>
                        <button onclick="setCurrency('TWD')" id="cur-TWD" class="currency-btn px-4 py-1 rounded-md text-[10px]">TWD</button>
                    </div>
                </div>
                <div class="space-y-4">
                    <input type="text" id="exp-name" placeholder="é …ç›®åç¨± (å¦‚ï¼šæ‹‰éºµ)" class="input-field">
                    <input type="number" id="exp-total" placeholder="é‡‘é¡" class="input-field font-mono">
                    <div>
                        <p class="text-[10px] font-bold text-gray-400 mb-2 uppercase">èª°å¢ŠéŒ¢ï¼Ÿ</p>
                        <div class="flex gap-2">
                            <button onclick="setPayer('ç¾Š')" id="payer-ç¾Š" class="payer-btn flex-grow py-2 rounded-xl text-xs font-bold font-sans">ç¾Š</button>
                            <button onclick="setPayer('P')" id="payer-P" class="payer-btn flex-grow py-2 rounded-xl text-xs font-bold font-sans">P</button>
                            <button onclick="setPayer('é¦®')" id="payer-é¦®" class="payer-btn flex-grow py-2 rounded-xl text-xs font-bold font-sans">é¦®</button>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-tighter">æˆå“¡åˆ†å¸³</p>
                            <div class="flex items-center gap-1">
                                <input type="checkbox" id="split-mode" onchange="toggleSplitMode()" class="w-3 h-3">
                                <label for="split-mode" class="text-[10px] font-bold text-blue-500 uppercase">è‡ªè¨‚</label>
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-2">
                            <div class="relative">
                                <input type="checkbox" id="member-ç¾Š" checked class="member-checkbox hidden">
                                <label for="member-ç¾Š" class="block text-center py-2 rounded-xl border border-gray-100 bg-gray-50 text-[10px] font-bold cursor-pointer font-sans">ç¾Š</label>
                                <input type="number" id="custom-ç¾Š" placeholder="0" class="custom-val hidden w-full mt-1 text-center text-[10px] font-mono border-b focus:outline-none p-1">
                            </div>
                            <div class="relative">
                                <input type="checkbox" id="member-P" checked class="member-checkbox hidden">
                                <label for="member-P" class="block text-center py-2 rounded-xl border border-gray-100 bg-gray-50 text-[10px] font-bold cursor-pointer font-sans">P</label>
                                <input type="number" id="custom-P" placeholder="0" class="custom-val hidden w-full mt-1 text-center text-[10px] font-mono border-b focus:outline-none p-1">
                            </div>
                            <div class="relative">
                                <input type="checkbox" id="member-é¦®" checked class="member-checkbox hidden">
                                <label for="member-é¦®" class="block text-center py-2 rounded-xl border border-gray-100 bg-gray-50 text-[10px] font-bold cursor-pointer font-sans">é¦®</label>
                                <input type="number" id="custom-é¦®" placeholder="0" class="custom-val hidden w-full mt-1 text-center text-[10px] font-mono border-b focus:outline-none p-1">
                            </div>
                        </div>
                    </div>
                    <button onclick="addExpense()" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold text-sm click-effect shadow-lg uppercase tracking-widest">æ–°å¢ç´€éŒ„</button>
                </div>
            </div>
            <div id="expense-list" class="space-y-3"></div>
        </section>
    </main>

    <!-- Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-lg border-t border-gray-100 px-6 py-3 flex justify-between items-center z-50">
        <button onclick="switchPage('schedule')" id="nav-item-schedule" class="flex flex-col items-center gap-1 nav-active transition-all">
            <span class="text-2xl">ğŸ—“ï¸</span><span class="text-[10px] font-bold uppercase tracking-widest">è¡Œç¨‹</span>
        </button>
        <button onclick="switchPage('tools')" id="nav-item-tools" class="flex flex-col items-center gap-1 nav-inactive transition-all">
            <span class="text-2xl">â°</span><span class="text-[10px] font-bold uppercase tracking-widest">é ç´„</span>
        </button>
        <button onclick="switchPage('ledger')" id="nav-item-ledger" class="flex flex-col items-center gap-1 nav-inactive transition-all">
            <span class="text-2xl">ğŸ’°</span><span class="text-[10px] font-bold uppercase tracking-widest">å¸³æœ¬</span>
        </button>
    </nav>

    <script>
        const tripData = [
            { day: 1, date: "03/25 WED", events: [
                { time: "06:40", type: "trans", title: "æ¡ƒåœ’ T1 å‡ºç™¼ (TR898)", note: "é…·èˆªï¼šé è¨ˆ 10:45 æŠµé” NRT T2", nav: "Taoyuan Airport T1" },
                { time: "11:58", type: "trans", title: "Skyliner 22 è™Ÿ", note: "12:58 æŠµé”æ—¥æš®é‡Œç«™ (<a href='https://www.keisei.co.jp/keisei/tetudou/skyliner/tc/traffic/skyliner.php' target='_blank' class='text-blue-500 underline'>æŸ¥çœ‹æ™‚åˆ»è¡¨</a>)", nav: "NRT" },
                { time: "13:30", type: "spot", title: "VIA INN ç§‹è‘‰åŸå¯„è¡Œæ", note: "é£¯åº—å…ˆæ”¾ä¸‹é‡ç‰©", nav: "VIA INN Akihabara" },
                { time: "15:00", type: "eat", title: "Eggslut Shinjuku", note: "æ¨è–¦ Fairfax Sandwich", nav: "Eggslut Shinjuku" },
                { time: "16:30", type: "buy", title: "æ–°å®¿ä¼Šå‹¢ä¸¹ & æ²»ä¸€éƒ", note: "B1 è²·å¹´è¼ªè›‹ç³• (20:00æ‰“çƒŠ)", nav: "Isetan Shinjuku" },
                { time: "20:00", type: "eat", title: "ç‰›èˆŒçš„æª¸æª¬", note: "é ç´„åˆ¶æ–°å®¿åšåˆ‡ç‰›èˆŒ (å·²é ç´„)", nav: "Gyutan no Lemon Shinjuku" }
            ]},
            { day: 2, date: "03/26 THU", events: [
                { time: "09:30", type: "spot", title: "ç‹å­ç¥ç¤¾ & å¦™ç¾©ç¥ç¤¾", note: "å¤è€ç¥ç¤¾æ–‡åŒ–å·¡ç¦®", nav: "Oji Shrine" },
                { time: "11:00", type: "eat", title: "é°»ã®æˆç€¬ ç¥ç”°åº—", note: "é£¯åº—é™„è¿‘æ­¥è¡Œå¯é”ï¼Œé«˜CPå€¼é°»é­šé£¯ (å·²é ç´„)", nav: "é°»ã®æˆç€¬ ç¥ç”°åº—" },
                { time: "13:30", type: "buy", title: "Pokemon Mega Tokyo", note: "æ± è¢‹å¤ªé™½åŸè³¼ç‰©", nav: "Pokemon Center Mega Tokyo" },
                { time: "15:30", type: "eat", title: "Pikachu Sweets", note: "å¿…è²·å¯¶å¯å¤¢ç”œé»", nav: "Pikachu Sweets" }
            ]},
            { day: 3, date: "03/27 FRI", events: [
                { time: "10:00", type: "spot", title: "ä¸‰é·¹ä¹‹æ£®å‰åœåŠ›", note: "å®®å´é§¿è¿·æœè– (<a href='https://www.threads.com/@ally_jeffery_0810/post/DUQBc7skRsA/-' target='_blank' class='text-blue-500 underline'>ä¸­æ–‡æŒ‡å—åœ°åœ–</a>)", nav: "Ghibli Museum" },
                { time: "13:30", type: "spot", title: "è±ªå¾·å¯º", note: "éœ‡æ’¼çš„ä¸Šåƒéš»æ‹›è²¡è²“ (16:30é—œ)", nav: "Gotokuji Temple" },
                { time: "15:30", type: "buy", title: "Poppy / Tokyo Bopper", note: "åŸå®¿å°çœ¾æ½®æµè¨­è¨ˆ", nav: "Poppy Tokyo Harajuku" },
                { time: "16:30", type: "buy", title: "Kinetics çƒé‹åº—", note: "æ½®æµé™é‡é‹æ¬¾å·¡ç¦®", nav: "Kinetics Harajuku" },
                { time: "17:30", type: "buy", title: "tarï¼ˆã‚¿ã‚¡ï¼‰æ¸‹è°·åº—", note: "æ¾€è°·æ½®æµåº—å·¡ç¦®", nav: "tar Shibuya" },
                { time: "18:30", type: "spot", title: "Pokemon Shibuya", note: "PARCO æ‹ 1:1 è¶…å¤¢", nav: "Pokemon Center Shibuya" },
                { time: "19:45", type: "eat", title: "Peter Luger ç‰›æ’", note: "å·²é ç´„ã€‚ç”¨é¤æ™‚é–“ 120 åˆ†é˜ã€‚", nav: "Peter Luger Steak House" }
            ]},
            { day: 4, date: "03/28 SAT", events: [
                { time: "10:00", type: "spot", title: "PokÃ©Park KANTO", note: "è®€è³£æ¨‚åœ’å†’éšª", nav: "Yomiuriland" },
                { time: "19:30", type: "eat", title: "è‚‰ç‡’å±‹ D-29 ç‡’è‚‰", note: "å’Œç‰›å°ˆå®¶ç§æˆ¿ååº—", nav: "Nikuyakiya D-29" }
            ]},
            { day: 5, date: "03/29 SUN", events: [
                { time: "09:30", type: "trans", title: "å¯Œå£«å›éŠç›´é”æ²³å£æ¹–", note: "æ–°å®¿å‡ºç™¼ 9:30 ç›´é€š", nav: "Kawaguchiko" },
                { time: "11:30", type: "spot", title: "æ–°å€‰å±±æ·ºè‰å…¬åœ’", note: "ç¶“å…¸å¯Œå£«å±±æ™¯ (<a href='https://fuji-san.info/zh-tw/index.html' target='_blank' class='text-blue-500 underline'>èƒ½è¦‹åº¦æŒ‡æ•¸</a>)", nav: "Chureito Pagoda" },
                { time: "14:30", type: "spot", title: "å¯Œå£«å¾¡å®¤æ·ºé–“ç¥ç¤¾", note: "å¯Œå£«å±±æœ€å¤è€ç¥ç¤¾", nav: "Fuji Omuro Asama Shrine" },
                { time: "16:30", type: "spot", title: "å¤§çŸ³å…¬åœ’æ•£æ­¥", note: "æ¬£è³å…¨æ™¯å¤•é™½å¯Œå£«", nav: "Oishi Park" }
            ]},
            { day: 6, date: "03/30 MON", events: [
                { time: "09:30", type: "spot", title: "ä»Šæˆ¶ç¥ç¤¾", note: "è²“å¥´å¿…å»æ‹›è²¡è²“ç¥ç¤¾", nav: "Imado Shrine" },
                { time: "11:30", type: "buy", title: "æ™´ç©ºå¡” & Pokemon", note: "1:1 çƒˆç©ºåå¿…æ‹", nav: "Pokemon Center Skytree Town" },
                { time: "13:30", type: "eat", title: "Sapporo Soup Curry Dominica", note: "æœ­å¹Œæ¹¯å’–å“©æ±äº¬ååº—", nav: "Sapporo Soup Curry Tokyo Dominica" },
                { time: "15:30", type: "eat", title: "Pokemon Cafe", note: "é ç´„åˆ¶é¤å»³ (<a href='https://digital-stamprally.jp/web/793' target='_blank' class='text-blue-500 underline'>å¯¶å¯å¤¢é›†ç« æ´»å‹•</a>)", nav: "Pokemon Cafe Tokyo DX" },
                { time: "17:30", type: "buy", title: "Pokemon Center Tokyo DX", note: "å·¨å¤§å¡æ¯”ç¸å¿…æ‹ï¼ (<a href='https://digital-stamprally.jp/web/793' target='_blank' class='text-blue-500 underline'>å¯¶å¯å¤¢é›†ç« æ´»å‹•</a>)", nav: "Pokemon Center Tokyo DX" },
                { time: "18:30", type: "eat", title: "æ ¹å®¤èŠ±ä¸¸ éŠ€åº§", note: "åŒ—æµ·é“æœ€å¼·å£½å¸ (å»ºè­°å…ˆæŠ½è™Ÿç¢¼ç‰Œ)", nav: "Nemuro Hanamaru Ginza" },
                { time: "20:30", type: "spot", title: "æ±äº¬éµå¡”æŠ•å½±ç§€", note: "Spring Concerto æ«»èŠ±æŠ•å½±", nav: "Tokyo Tower Main Deck" }
            ]},
            { day: 7, date: "03/31 TUE", events: [
                { time: "11:00", type: "buy", title: "Yamashiroya ç©å…·åº—", note: "ä¸Šé‡ç«™å‰ 7 å±¤ç©å…·å¤©å ‚", nav: "Yamashiroya Ueno" },
                { time: "13:30", type: "trans", title: "å‰å¾€æˆç”°æ©Ÿå ´ T1", note: "é è¨ˆ 14:30 æŠµé”è»Šç«™", nav: "Keisei Ueno" },
                { time: "16:50", type: "trans", title: "æˆç”° T1 è¿”å° (MM625)", note: "æ¨‚æ¡ƒï¼šé è¨ˆ 19:40 æŠµé”æ¡ƒåœ’ T1", nav: "Narita Airport T1" }
            ]}
        ];

        let expenses = JSON.parse(localStorage.getItem('tokyo_split_v4')) || [];
        let currentPayer = 'ç¾Š';
        let currentCurrency = 'JPY';

        function init() {
            const scroller = document.getElementById('day-scroller');
            scroller.innerHTML = [1,2,3,4,5,6,7].map((d, idx) => `
                <button onclick="changeDay(${idx})" id="day-btn-${idx}" class="flex-shrink-0 w-14 h-20 rounded-2xl flex flex-col items-center justify-center border-2 border-transparent bg-white shadow-sm transition-all click-effect">
                    <span class="text-[10px] mb-1">D${d}</span>
                    <span class="text-lg font-bold">${d===1?'25':d===2?'26':d===3?'27':d===4?'28':d===5?'29':d===6?'30':'31'}</span>
                </button>
            `).join('');
            changeDay(0);
            setPayer('ç¾Š');
            setCurrency('JPY');
            updateLedgerUI();
        }

        function changeDay(idx) {
            document.querySelectorAll('#day-scroller button').forEach((btn, i) => {
                btn.className = i === idx ? 
                    "flex-shrink-0 w-14 h-20 rounded-2xl flex flex-col items-center justify-center border-2 border-jp-black bg-jp-black text-gray-400 shadow-sm" : 
                    "flex-shrink-0 w-14 h-20 rounded-2xl flex flex-col items-center justify-center border-2 border-transparent bg-white text-gray-900 shadow-sm";
            });
            const dayData = tripData[idx];
            document.getElementById('header-date').innerText = dayData.date;
            document.getElementById('timeline').innerHTML = dayData.events.map(ev => `
                <div class="flex gap-4 font-sans text-gray-700">
                    <div class="flex flex-col items-center"><div class="w-2.5 h-2.5 rounded-full bg-slate-300 mt-2"></div><div class="w-0.5 flex-grow bg-slate-100"></div></div>
                    <div class="app-card flex-grow p-4 mb-2">
                        <span class="text-xs font-mono font-bold text-blue-500">${ev.time}</span>
                        <h4 class="font-bold text-sm text-gray-800 font-sans">${ev.title}</h4>
                        <div class="text-[11px] text-gray-500 leading-normal mb-1 font-sans">${ev.note}</div>
                        <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.nav)}" target="_blank" class="block text-center mt-2 py-1.5 bg-gray-900 text-white rounded-lg text-[10px] font-bold">ğŸ§­ å°èˆª</a>
                    </div>
                </div>
            `).join('');
        }

        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${pageId}`).classList.add('active');
            document.querySelectorAll('nav button').forEach(btn => { btn.classList.remove('nav-active'); btn.classList.add('nav-inactive'); });
            document.getElementById(`nav-item-${pageId}`).classList.add('nav-active');
            const titles = { schedule: 'æ¯æ—¥è¡Œç¨‹', tools: 'é ç´„ä¸­å¿ƒ', ledger: 'æ—…è¡Œå¸³æœ¬' };
            document.getElementById('current-page-title').innerText = titles[pageId];
        }

        function setCurrency(cur) {
            currentCurrency = cur;
            document.querySelectorAll('.currency-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`cur-${cur}`).classList.add('active');
        }

        function setPayer(who) {
            currentPayer = who;
            document.querySelectorAll('.payer-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`payer-${who}`).classList.add('active');
        }

        function toggleSplitMode() {
            const isCustom = document.getElementById('split-mode').checked;
            document.querySelectorAll('.custom-val').forEach(el => el.classList.toggle('hidden', !isCustom));
        }

        function addExpense() {
            const name = document.getElementById('exp-name').value;
            const amount = parseFloat(document.getElementById('exp-total').value);
            const isCustom = document.getElementById('split-mode').checked;
            if (!name || isNaN(amount)) return alert("è«‹è¼¸å…¥é‡‘é¡èˆ‡åç¨±");
            const participants = [];
            ['ç¾Š', 'P', 'é¦®'].forEach(m => { if(document.getElementById(`member-${m}`).checked) participants.push(m); });
            if (participants.length === 0) return alert("è«‹é¸æ“‡æˆå“¡");
            let splits = {};
            if (isCustom) {
                let sum = 0;
                participants.forEach(m => {
                    const v = parseFloat(document.getElementById(`custom-${m}`).value) || 0;
                    splits[m] = v; sum += v;
                });
                if (Math.abs(sum - amount) > 1) return alert("è‡ªè¨‚é‡‘é¡èˆ‡ç¸½é¡ä¸ç¬¦");
            } else {
                const avg = Math.round((amount / participants.length) * 100) / 100;
                participants.forEach(m => splits[m] = avg);
            }
            expenses.unshift({ id: Date.now(), name, amount, currency: currentCurrency, payer: currentPayer, splits });
            localStorage.setItem('tokyo_split_v4', JSON.stringify(expenses));
            document.getElementById('exp-name').value = '';
            document.getElementById('exp-total').value = '';
            updateLedgerUI();
        }

        function deleteExpense(id) {
            if(confirm('ç¢ºå®šåˆªé™¤æ­¤ç´€éŒ„ï¼Ÿ')) {
                expenses = expenses.filter(e => e.id !== id);
                localStorage.setItem('tokyo_split_v4', JSON.stringify(expenses));
                updateLedgerUI();
            }
        }

        function updateLedgerUI() {
            const list = document.getElementById('expense-list');
            const balance = { 'ç¾Š': { JPY: 0, TWD: 0 }, 'P': { JPY: 0, TWD: 0 }, 'é¦®': { JPY: 0, TWD: 0 } };
            list.innerHTML = expenses.map(exp => {
                const cur = exp.currency;
                ['ç¾Š', 'P', 'é¦®'].forEach(m => {
                    const share = exp.splits[m] || 0;
                    if (m === exp.payer) balance[m][cur] -= (exp.amount - share);
                    else balance[m][cur] += share;
                });
                return `
                    <div class="app-card p-4 border-l-4 ${exp.payer==='ç¾Š'?'border-rose-200':exp.payer==='P'?'border-blue-200':'border-amber-200'}">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="text-xs font-bold text-gray-800 font-sans">${exp.name}</h4>
                                <p class="text-[10px] font-mono text-gray-400 font-sans">${cur === 'JPY' ? 'Â¥' : '$'} ${exp.amount.toLocaleString()} | å¢Šä»˜: ${exp.payer}</p>
                            </div>
                            <button onclick="deleteExpense(${exp.id})" class="text-gray-300 px-2 text-sm font-bold font-sans">âœ•</button>
                        </div>
                    </div>
                `;
            }).join('');
            ['ç¾Š', 'P', 'é¦®'].forEach(m => {
                const j = Math.round(balance[m].JPY);
                const t = Math.round(balance[m].TWD);
                document.getElementById(`sum-jpy-${m}`).innerText = `Â¥ ${j.toLocaleString()}`;
                document.getElementById(`sum-twd-${m}`).innerText = `$ ${t.toLocaleString()}`;
                document.getElementById(`sum-jpy-${m}`).className = `font-mono text-[11px] ${j > 0 ? 'text-rose-400' : 'text-fuji-blue'}`;
                document.getElementById(`sum-twd-${m}`).className = `font-mono text-[11px] ${t > 0 ? 'text-rose-400' : 'text-fuji-blue'}`;
            });
        }
        window.onload = init;
    </script>
</body>
</html>